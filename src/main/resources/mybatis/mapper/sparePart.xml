<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sparePart">

	<!-- sparePart 조회 -->
	<select id="getSparePartList" parameterType="sparePart"
		resultType="sparePart">
		SET LOCK_TIMEOUT 10000;

		WITH PARTS AS (
		SELECT
		MAX(SPAREPART.SPP_IDX) AS SPP_IDX,
		SUM(SPAREHISTORY.SPH_INPUT) AS SPH_INPUT,
		SUM(SPAREHISTORY.SPH_SURIOUT) AS SPH_SURIOUT,
		SUM(SPAREHISTORY.SPH_JASANOUT) AS SPH_JASANOUT,
		SPAREPART.SPP_PURCHASE,
		SPAREPART.SPP_NO,
		SPAREPART.SPP_NAME,
		SPAREPART.SPP_GYU,
		SPAREPART.SPP_YONG,
		SPAREPART.SPP_PROPER,
		SPAREPART.SPP_IMAGE,
		SPAREPART.SPP_BIGO
		FROM SPAREHISTORY WITH(NOLOCK)
		RIGHT OUTER JOIN SPAREPART WITH(NOLOCK) ON SPAREHISTORY.SPP_IDX =
		SPAREPART.SPP_IDX
		WHERE SPAREPART.SPP_IDX > 0
		GROUP BY
		SPAREPART.SPP_PURCHASE,
		SPAREPART.SPP_NO,
		SPAREPART.SPP_NAME,
		SPAREPART.SPP_GYU,
		SPAREPART.SPP_YONG,
		SPAREPART.SPP_PROPER,
		SPAREPART.SPP_IMAGE,
		SPAREPART.SPP_BIGO
		)

		SELECT
		*,
		SPH_INPUT - SPH_SURIOUT - SPH_JASANOUT AS JAIGO
		FROM PARTS WITH(NOLOCK)
		ORDER BY SPP_NO ASC 

	</select>



</mapper>